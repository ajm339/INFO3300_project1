<html>
	<head>
		<title>Project 1</title>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="http://fb.me/react-0.9.0.min.js"></script>
		<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>

		<style>
			svg { border: solid black 1px; }
			.axis path { fill: none; stroke: black;}
			.axis line { stroke: black; }
			text.trending_words { font-size: small; font-family: "Helvetica"; opacity: 0.3; text-anchor: middle; alignment-baseline: central; cursor: pointer;}
			text.trending_words:hover { fill: blue; opacity: 1.0; font-weight: bold; font-size: xx-large; }
		</style>
	</head>



	<body>
		<h1>Project 1</h1>
		<div id='spot'></div>
		<div id='canvas'></div>


		<script>

        var xScale = d3.scale.linear().domain([0, 20]).range([150,880]);
		var yScale = d3.scale.linear().domain([-20,20]).range([750,20]);
		
		var svg = d3.select("#canvas").append("svg").attr("height", 800).attr("width", 1050);


		var input = [
			{"word": "of", "x": 1, "y": 5},
			{"word": "the", "x": 4, "y": -4},
			{"word": "banana", "x": 8, "y": 0}  ];

  			var words = svg.selectAll("text").data(input).enter().append("text");
  			var wordAttributes = words
  				.attr("class", "trending_words")
  				.attr("x", function(w) {return xScale(w.x);})
  				.attr("y", function(w) {return yScale(w.y);})
  				.text(function (w) { return w.word; })


  		svg.append("text").attr("x", xScale(-3)).attr("y", yScale(-0.5)).text("Time Blocks");
  		svg.append("text").attr("x", xScale(-11)).attr("y", yScale(16)).text("Trending Status").attr("transform", "rotate(-90)");
  		svg.append("text").attr("x", xScale(-12)).attr("y", yScale(15)).text("(is popularity increasing or decreasing over time)").attr("transform", "rotate(-90)").attr("font-size", "8pt");
  		

		var xAxis = d3.svg.axis().scale(xScale);

		svg.append("g").attr("class", "axis").attr("transform", "translate(0, " + yScale(0) + ")").call(xAxis);

		var yAxis = d3.svg.axis().scale(yScale).orient("left");
		svg.append("g").attr("class", "axis").attr("transform", "translate(" + xScale(0) + ", 0)").call(yAxis);

  //       var posts = [];



		// var stuff = {
		// 	coolstuff: function(x){posts = posts.concat(x.data.children);},
		// 	test: 'hey',
		// 	hello: function(){return "hello world";}
		// }
        
  //       function processChunk(chunk){//takes a chunk of reddit data and pulls the info we want from it
        
        
  //       }
        
		// var RedditData = React.createClass({
		// 	doFunction:function(x) {
		// 		console.log(x);
		// 	},
		//     loadRedditDataFromServer: function() {
		//     	var fuck = this.state.reddit_data;
		//         $.ajax({
		//             url: this.props.url,
		//             type: 'GET',
		//             success: function(data) {
		//             	this.setState({reddit_data: data});
		//             	stuff.coolstuff(this.state.reddit_data);
		//             }.bind(this)
		//         });
		//     },
		//     getInitialState: function() {
		//         return {reddit_data: []};
		//     },
		//     componentWillMount: function() {
		//       this.loadRedditDataFromServer();
		//       setInterval(this.loadRedditDataFromServer, this.props.pollInterval);
		//     },
		//     render: function() {
		//         return (
		//           React.DOM.div(
		//             {className: 'new_reddit_data',
		//             children: [this.state.reddit_data]
		//             })
		//         );
		//     }
		// });

	    
	 //    React.renderComponent(
	 //        RedditData({url:'http://www.reddit.com/new/.json', pollInterval: '120000'}),  document.getElementById('spot')
	 //    );
		// 		var fuck = '';
		// 		$.ajax({
		//             url: 'http://www.reddit.com/new/.json',
		//             type: 'GET',
		//             success: function(data) {
		//             	fuck = data;
		//             	console.log(fuck);
		//             }.bind(this)
		//         });
        
        var posts = [];

        var relDat = [];

		var stuff = {
			coolstuff: function(x){posts = posts.concat(x.data.children);},
			test: 'hey',
			hello: function(){return "hello world";}
		}
        
        function processChunk(chunk){//takes a chunk of reddit data and pulls the info we want from it


        
        }

        var getter = {
            acc : [],
            baseURL : "http://www.reddit.com/new/.json?&limit=100",
            nextURL : null,
            apiCount : 0,
            prevData: null,
            getNPagesCt : 0,

            nextPageURL: function(data){
                this.apiCount+=100;
                this.nextURL = (this.baseURL+"&count="+this.apiCount+"&after="+data.data.after);
            },

            requestAPage : function(){
                if (this.nextURL==null){
                    var url = this.baseURL;
                }else{
                    var url = this.nextURL;
                }
                $.ajax({
                    url: url,
                    type: 'GET',
                    success: function(data) {
                        //console.log(data);
                        //console.log("acc length="+this.acc.length);
                        //console.log(this.nextURL);

                        console.log("Querried: "+url);
                        console.log("nextURL:  "+this.nextURL);
                        console.log(data.data.after);
                        this.prevData = data;
                        this.acc = this.acc.concat(data.data.children);
                        this.nextPageURL(data);
                        console.log("NEW nextURL:  "+this.nextURL)

                        //console.log(data);
                        //console.log("acc length="+this.acc.length);
                        //console.log(this.nextURL);

                    }.bind(this)
                });
            },

            returnUniques : function(){
                var unqs = [];
                var i;
                for (i= 0; i < this.acc.length ; i++){
                    if(unqs.indexOf(this.acc[i]) == -1){
                        unqs = unqs.concat(this.acc[i]);
                    }
                }
                console.log(this.acc.length);
                console.log(unqs.length);
            },

            get10pages : setInterval(function(){
                getter.requestAPage();
                getter.getNPagesCt ++;
                if (getter.getNPagesCt >= 10){
                    clearInterval(getter.get10pages);
                }
                console.log(getter.acc.length);
            },2000),

            timeBins : function(){
                var times = [];
                this.acc.forEach(function(p){times = times.concat(p.data.created_utc);});
                var start = Math.min.apply(Math, times);
                var end = Math.max.apply(Math, times);
                this.acc.forEach(function(p){
                    ((p.data.created_utc - start)/60)
                });
            }

        }

        function extractTitleWords(posts){
            var words = [];
            posts.forEach(function(p){
                words = words.concat(p.data.title.toLocaleLowerCase().split(" "));
            });

            wordCounter = {};
            words.forEach(function(w){
               if(typeof(wordCounter[w.toLocaleLowerCase()])=="number"){
                   wordCounter[w.toLocaleLowerCase()]+=1;
               }else{
                   wordCounter[w.toLocaleLowerCase()]=1;
               }
            });

            return wordCounter;
        }

		</script>
	</body>
</html>